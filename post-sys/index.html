<!DOCTYPE html>
<html>
  <head>
    <title>Posts</title>
    <meta charset="UTF-8" />
    <style>
      * + *:not(body) {
        margin-top: 10px;
      }
      * {
        padding: 10px;
        margin: 0;
        font-family: monospace;
        outline: none;
      }
      html, span {
        padding: 0;
      }
      ul {
        list-style-type: none;
      }
      li:before {
        content: "\A0";
        text-decoration: underline;
      }
      .gray {
        background: rgba(0, 0, 0, 0.1);
        border: 1px solid #333;
      }
      .em {
        border-width: 3px;
      }
      .author {
        color: #444;
      }
    </style>
  </head>
  <body>
    <div class="new gray">
      <div class="in gray" contenteditable="plaintext-only"></div>
    </div>
    <div class="feed gray">
      <div class="gray">
        TODO:
        <ul>
          <li>
            Add p2p support
          </li>
          <li>
            Add profile pics
          </li>
          <li>
            Add in-client handle changing and validation
          </li>
        </ul>
      </div>
    </div>
    <div class="settings gray">
      <div class="handle gray">
        <div class="in gray" contenteditable="plaintext-only"></div>
        <button class="em gray">change handle</button>
      </div>
    </div>
    <script>
      var handle = (function() {
        var handleInternal = "anon";
        return function(newhandle) {
          return (handleInternal = newhandle || handleInternal);
        };
      })();
      document.querySelector(".new .in").onkeypress = function(e) {
        if (e.keyCode == 13) {
          addPost(handle(), this.innerHTML);
          this.innerHTML = "";
          return false;
        } else {
          return true;
        }
      };
      var addPost = function(posterName, content) {
        var post = document.createElement("div");
        post.className = "post gray";
        post.innerHTML = content;
        post.appendChild(document.createElement("br"));
        var author = document.createElement("span");
        author.className  = "author";
        author.innerHTML = "by " + posterName + " @ " + new Date(Date.now()).toString();
        post.appendChild(author);
        document.querySelector(".feed").insertBefore(post, document.querySelector(".feed").childNodes[0]);
      };
      document.querySelector(".settings .handle .in").onkeypress = function(e) {
        if (e.keyCode == 13) {
          handle(this.innerHTML);
          this.innerHTML = "";
          return false;
        } else {
          return true;
        }
      };
      document.querySelector(".settings .handle button").onclick = function() {
        handle(document.querySelector(".settings .handle .in").innerHTML);
        document.querySelector(".settings .handle .in").innerHTML = "";
      };
    </script>
  </body>
</html>
<!--
        .replace(/[\u00A0-\u9999<>\&]/gim, function(i) {
          return "&#" + i.charCodeAt(0) + ";";
        })
-->
