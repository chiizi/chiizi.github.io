<!DOCTYPE html>
<html>
  <head>
    <script src="/js/polymer-loader.js"></script>
    <title>Posts</title>
    <meta charset="UTF-8" />
    <style>
      body {
        display: flex;
        flex-direction: column;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
      }
      paper-card {
        width: 100%;
      }
      paper-card + paper-card {
        margin-top: 16px;
      }
    </style>
  </head>
  <body>
    <paper-card class="new">
      <paper-input class="in" label="message here..."></paper-input>
      <paper-button class="em">post</paper-button>
    </paper-card>
    <paper-card class="feed">
      <paper-card>
        TODO:
        <ul>
          <li>
            Add p2p support
          </li>
          <li>
            Add profile pics
          </li>
          <li>
            Add in-client handle validation
          </li>
        </ul>
      </paper-card>
    </paper-card>
    <paper-card class="settings">
      <paper-card class="handle">
        <paper-input class="in" label="new handle"></paper-input>
        <paper-button class="em">change handle</paper-button>
      </paper-card>
    </paper-card>
    <script>
      importPolymer("1.1.4", "paper-card", "paper-button", "paper-input");
      var handle = (function() {
        var handleInternal = "a person";
        return function(newhandle) {
          return (handleInternal = newhandle || handleInternal);
        };
      })();
      document.querySelector(".new .in").onkeypress = function(e) {
        if (e.keyCode == 13) {
          addPost(handle(), this.value);
          this.value = "";
          return false;
        } else {
          return true;
        }
      };
      document.querySelector(".new paper-button").onclick = function() {
        addPost(handle(), document.querySelector(".new .in").value);
        document.querySelector(".new .in").value = "";
      };
      var addPost = function(posterName, content) {
        var post = document.createElement("paper-card");
        post.className = "post";
        post.innerHTML = content;
        post.appendChild(document.createElement("br"));
        var author = document.createElement("span");
        author.className  = "author";
        author.innerHTML = "by " + posterName + " @ " + new Date(Date.now()).toString();
        post.appendChild(author);
        if (content)
          document.querySelector(".feed").insertBefore(post, document.querySelector(".feed").childNodes[0]);
      };
      document.querySelector(".settings .handle .in").onkeypress = function(e) {
        if (e.keyCode == 13) {
          handle(this.value);
          this.value = "";
          return false;
        } else {
          return true;
        }
      };
      document.querySelector(".settings .handle paper-button").onclick = function() {
        handle(document.querySelector(".settings .handle .in").value);
        document.querySelector(".settings .handle .in").value = "";
      };
    </script>
  </body>
</html>
<!--
        .replace(/[\u00A0-\u9999<>\&]/gim, function(i) {
          return "&#" + i.charCodeAt(0) + ";";
        })
-->
